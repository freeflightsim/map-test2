<!DOCTYPE html>
<html lang="en">
 <head>
  <title>
   Color Height Mapping 5
  </title>
  <meta charset="utf-8">
  <style type="text/css">
body { 
  margin : 0 1cm 0 1cm;
  font-family: Courier, sans-serif; 
  }
  table, tr, td {
    margin: 0;
    text-align: center;
  }
  </style>
 </head>
 <body>
  <h1 align="center">
   Color Height Mapping
  </h1>

  <p>
   After looking at <a target="_blank"
      href="https://github.com/jaanga/cookbook/tree/gh-pages/un-flatland/unicam">cookbook/un-flatland/unicam</a>
      I started to think about a suitable height map color scheme. I know some prefer a grayscale,
      and that is ok, but I wanted to explore colors. I wanted a way I could use a math algorithm
      on an elevation value, and set a color. Yes, it could be a table look-up with ranges, but
      here I generated a 17 x 16 grid of colors, where I go from 0x00ff00, increasing the red
      component and reducing the green, to 0xff0000, then one extra 17th line where the red is
      reduced. This give me 272 colors to use, although the last at least 4 are too close to
      black, so say 268 colors or so, all in the red/green range.
  </p>
  <script type="text/javascript">
function tohex(num,len) {
    var str = num.toString(16);
    while (str.length < len) {
       str = '0'+str;
    }
    return str;
  }
  function tohexcolor(num) {
    return tohex(num,6);
  }

  function add_unicam() {
    var unicam = new Array(
        new Array(20,0,0,">= 6000"),
        new Array(32,0,0,"5000 - 6000"),
        new Array(44,0,0,"4500 - 5000"),
        new Array(56,0,0,"4000 - 4500"),
        new Array(68,0,0,"3500 - 4000"),
        new Array(80,0,0,"3000 - 3500"),
        new Array(92,0,0,"2500 - 3000"),
        new Array(104,0,0,"2000 - 2500"),
        new Array(116,0,0,"1900 - 2000"),
        new Array(128,0,0,"1800 - 1900"),
        new Array(140,0,0,"1700 - 1800"),
        new Array(152,0,0,"1600 - 1700"),
        new Array(164,0,0,"1500 - 1600"),
        new Array(176,0,0,"1400 - 1500"),
        new Array(188,0,0,"1300 - 1400"),
        new Array(200,0,0,"1200 - 1300"),
        new Array(210,8,3,"1100 - 1200"),
        new Array(218,24,9,"1000 - 1100"),
        new Array(226,40,15,"950 - 1000"),
        new Array(234,56,21,"900 - 950"),
        new Array(242,72,27,"850 - 900"),
        new Array(250,88,33,"800 - 850"),
        new Array(255,104,39,"750 - 800"),
        new Array(255,120,45,"700 - 750"),
        new Array(255,136,51,"650 - 700"),
        new Array(255,152,57,"600 - 650"),
        new Array(255,168,63,"550 - 600"),
        new Array(255,184,69,"500 - 550"),
        new Array(255,200,75,"450 - 500"),
        new Array(255,216,81,"400 - 450"),
        new Array(255,232,87,"350 - 400"),
        new Array(255,242,0,"300 - 350"),
        new Array(255,248,93,"250 - 300"),
        new Array(255,255,99,"200 - 250"),
        new Array(197,243,0,"180 - 200"),
        new Array(139,222,0,"160 - 180"),
        new Array(0,220,0,"140 - 160"),
        new Array(100,228,0,"120 - 140"),
        new Array(0,242,0,"100 - 120"),
        new Array(35,255,20,"90 - 100"),
        new Array(96,255,20,"80 - 90"),
        new Array(134,255,20,"70 - 80"),
        new Array(157,255,20,"60 - 70"),
        new Array(177,255,20,"50 - 60"),
        new Array(200,255,20,"40 - 50"),
        new Array(200,255,106,"30 - 40"),
        new Array(200,255,154,"20 - 30"),
        new Array(200,255,192,"10 - 20"),
        new Array(200,255,237,"5 - 10"),
        new Array(227,255,255,"0 - 5"),
        new Array(210,255,255,"0 - -200"),
        new Array(193,255,255,"-200 - -400"),
        new Array(0,0,128,"-400 - -9999")
        );
    var max = unicam.length;
    var add_rgb = 0;    // maybe better without adding the rgb value
    var i,a,r,g,b,clr,color,txt,i2,sty;
    var wrap = 3;
    var cnt = 0;
    var html = '<div align="center">';
    html += "<table align='center' border='0' cellspacing='2' cellpadding='2'>";
    html += "<caption>UniCam - Solid Earth Reseach Group<\/caption>";
    html += '<thead>';
    html += "<tr>";
    while (cnt < wrap) {
        html += '<th>#<\/th>';
        html += '<th>Elevation<\/th>';
        if (add_rgb) {
            html += '<th>R<\/th>';
            html += '<th>G<\/th>';
            html += '<th>B<\/th>';
        }
        html += '<th>Hex<\/th>';
        cnt++;
    }    
    html += "<\/tr>";
    html += '<\/thead>';
    cnt = 0;
    for (i = 0; i < max; i++) {
        i2 = i + 1;
        a = unicam[i];
        r = a[0];
        g = a[1];
        b = a[2];
        txt = a[3];
        clr = (r * 0x10000) + (g * 0x100) + b;
        color = tohexcolor(clr);
        if (cnt == 0) {
            html += "<tr>";
        }
        if ((i < 20) || ((i + 1) == max)) {
            sty = 'align="center" style=background-color:#'+color+';color:white;';
        } else {
            sty = 'align="center" style=background-color:#'+color+';';
        }
        html += '<td '+sty+'>'+i2+'<\/td>';
        html += '<td '+sty+'>'+txt+'<\/td>';
        if (add_rgb) {
            html += '<td '+sty+'>'+r+'<\/td>';
            html += '<td '+sty+'>'+g+'<\/td>';
            html += '<td '+sty+'>'+b+'<\/td>';
        }
        html += '<td '+sty+'>'+color+'<\/td>';
        cnt++;
        if (cnt == wrap) {
            html += "<\/tr>";
            cnt = 0;
        }
    }
    if (cnt) {
        while (cnt < wrap) {
            html += '<td>&nbsp;<\/td>';
            html += '<td>&nbsp;<\/td>';
            if (add_rgb) {
                html += '<td>&nbsp;<\/td>';
                html += '<td>&nbsp;<\/td>';
                html += '<td>&nbsp;<\/td>';
            }
            html += '<td>&nbsp;<\/td>';
            cnt++;
        }
        html += "<\/tr>";
    }
    html += '<\/table>';
    html += '<\/div>';
    document.write(html);
  }

  function init() {
    var i, j, clr2;
    var clr = 0x00ff00;
    var color, html;

    html = '<div align="center">';
    html += "<table align='center' border='0' cellspacing='1' cellpadding='0'>";
    html += "<caption>Height Gradients<\/caption>";
    for (i = 0; i < 16; i++) {
        html += "<tr>";
    color = tohexcolor(clr)
    html += "<td>"+color+"<\/td>";
    html += "<td>&nbsp;<\/td>";
    clr2 = clr + 0x100 - 0x10000;
    for (j = 0; j < 16; j++) {
       clr2 -= 0x100;     // reduce green
       clr2 += 0x10000; // add red
       color = tohexcolor(clr2);
            html += "<td style=background-color:#"+color+";>"+color+"<\/td>";
       //clr2 += 0x02;
    }
    color = tohexcolor(clr2);
    html += "<td>&nbsp;<\/td>";
    html += "<td>"+color+"<\/td>";
        html += "<\/tr>";
    clr += 0x100000;   // add red
    clr -= 0x1000;

    }
    // one more row, reducing the red
    clr = 0xff0000;
        html += "<tr>";
    color = tohexcolor(clr)
    html += "<td>"+color+"<\/td>";
    html += "<td>&nbsp;<\/td>";
    clr2 = clr + 0x100000;
    for (j = 0; j < 16; j++) {
       clr2 -= 0x100000; // add red
       color = tohexcolor(clr2);
            html += "<td style=background-color:#"+color+";color:white;>"+color+"<\/td>";
       //clr2 += 0x02;
    }
    color = tohexcolor(clr2);
    html += "<td>&nbsp;<\/td>";
    html += "<td>"+color+"<\/td>";
        html += "<\/tr>";

    html += "<\/table>";
    html += "<\/div>";
    document.write(html);
    
    html = "<p>And a smaller blue range for the sea, and below mean sea level.<\/p>";
    html += '<div align="center">';
    html += "<table align='center' border='0' cellspacing='1' cellpadding='0'>";
    html += "<caption>Sea Color<\/caption>";
    clr = 0xff;
    //for (i = 0; i < 16; i++) {
        html += "<tr>";
    color = tohexcolor(clr)
    html += "<td>"+color+"<\/td>";
    html += "<td>&nbsp;<\/td>";
        clr2 = clr - 0x1000;
    for (j = 0; j < 16; j++) {
                clr2 += 0x1000; // add green
       color = tohexcolor(clr2);
            html += "<td style=background-color:#"+color+";>"+color+"<\/td>";
    }
    html += "<td>&nbsp;<\/td>";
    html += "<td>"+color+"<\/td>";
        html += "<\/tr>";
    //}
    html += "<\/table>";
    html += '<\/div>';
    document.write(html);

    // another scheme
    html = '<p>Then I started to search the web a bit for other ideas. '+
        'Here are color samples from <a target="_blank" href="http://colorbrewer2.org/">http://colorbrewer2.org/<\/a><\/p>';
    html += '<div align="center">';
    html += "<table align='center' border='0' cellspacing='4' cellpadding='0'>";
    html += "<tr>";
    html += "<td>fff7ec<\/td>";
    html += "<td>&nbsp;<\/td>";
    html += "<td style=background-color:#fff7ec;>fff7ec<\/td>";
    html += "<td style=background-color:#fee8c8;>fee8c8<\/td>";
    html += "<td style=background-color:#fdd49e;>fdd49e<\/td>";
    html += "<td style=background-color:#fdbb84;>fdbb84<\/td>";
    html += "<td style=background-color:#fc8d59;>fc8d59<\/td>";
    html += "<td style=background-color:#ef6548;>ef6548<\/td>";
    html += "<td style=background-color:#d7301f;>d7301f<\/td>";
    html += "<td style=background-color:#b30000;>b30000<\/td>";
    html += "<td style=background-color:#7f0000;>7f0000<\/td>";
    html += "<td>&nbsp;<\/td>";
    html += "<td>7f0000<\/td>";
    html += "<\/tr>";
    html += "<\/table>";
    html += '<\/div>';
    html += "<p>Or the browns<\/p>";
    var colors = new Array( 0xffffe5, 0xfff7bc, 0xfee391, 0xfec44f, 0xfe9929, 0xec7014, 0xcc4c02, 0x993404, 0x662506 );
    var max = colors.length;
    html += '<div align="center">';
    html += "<table align='center' border='0' cellspacing='4' cellpadding='0'>";
    html += "<tr>";
    clr = colors[0];
    color = tohexcolor(clr);
    html += "<td>"+color+"<\/td>";
    html += "<td>&nbsp;<\/td>";
    for (i = 0; i < max; i++) {
        clr = colors[i];
        color = tohexcolor(clr);
        html += "<td style=background-color:#"+color+";>"+color+"<\/td>";
    }
    html += "<td>&nbsp;<\/td>";
    clr = colors[max-1];
    color = tohexcolor(clr);
    html += "<td>"+color+"<\/td>";
    html += "<\/tr>";
    html += "<\/table>";
    html += '<\/div>';
    document.write(html);
    
    html = "<p>Then taken from my <a target=\"_blank\" href=\"https://gitorious.org/fgtools/atlas-g/\">fork<\/a> "+
        "of flightgear Atlas/Map default palette, which seems to lack any 'linear' quality,"+
        " but then Altas 'concentrates' on coloring land use classes, and only when a 'feature' "+
        "is 'undefined', this elevation color will be used...<\/p>";
    var atlas_palette = new Array(
        new Array(0.647, 0.729, 0.647, "E_-250" ),
        new Array(0.859, 0.906, 0.804, "E_0"    ),
        new Array(0.753, 0.831, 0.682, "E_250"  ),
        new Array(0.949, 0.933, 0.757, "E_500"  ),
        new Array(0.941, 0.871, 0.608, "E_1000" ), 
        new Array(0.878, 0.725, 0.486, "E_2500" ), 
        new Array(0.816, 0.616, 0.443, "E_5000" ),
        new Array(0.776, 0.529, 0.341, "E_7500" ),
        new Array(0.750, 0.725, 0.600, "E_10000" ),
        new Array(0.824, 0.863, 0.824, "E_20000" ) 
        );
    
    max = atlas_palette.length;
    var rgb, r, g, b, elev;
    html += '<div align="center">';
    html += "<table align='center' border='0' cellspacing='4' cellpadding='0'>";
    html += "<tr>";
    for (i = 0; i < max; i++) {
        rgb = atlas_palette[i];
        elev = rgb[3];
        html += "<td>"+elev+"<\/td>";
    }
    html += "<\/tr>";
    html += "<tr>";
    for (i = 0; i < max; i++) {
        rgb = atlas_palette[i];
        r = 255 * rgb[0];
        g = 255 * rgb[1];
        b = 255 * rgb[2];
        clr = r * 0x10000;
        clr += g * 0x100;
        clr += b;
        color = tohexcolor(clr);
        clr2 = parseInt(color,16);
        color = tohexcolor(clr2);
        html += "<td style=background-color:#"+color+";>"+color+"<\/td>";
    }
    html += "<\/tr>";
    html += "<\/table>";
    html += '<\/div>';
    document.write(html);
    
    html = '<p>And concerning the current cookbook unicam png generation, a table idea from '+
        '<a target="_blank" href="http://www.serg.unicam.it/Gtopohelp.html">'+
        'Universita degli Studi di Camerino<\/a>, which looks quite interesting '+
        'in that it is a table look-up with elevation ranges.<\/p>';
    document.write(html);
    add_unicam();
  }

  init();

  </script>
  <p>
   Further web searching led me to MANY interesting images, like this one <a target="_blank"
      href="http://serc.carleton.edu/images/eslabs/corals/ocean_depth_colorscale.jpg">http://serc.carleton.edu/images/eslabs/corals/ocean_depth_colorscale.jpg</a>
      which triggers the idea that maybe the scale should not be so strictly 'linear', but more
      'exponential' due the the fact that the majority of the world is less that about 5,000
      meters... and here <a target="_blank"
      href="http://www.theodora.com/maps/new/world_maps_2.html">http://www.theodora.com/maps/new/world_maps_2.html</a>,
      and just so many others... Seemingly each with their 'own' color mapping scheme...
  </p>

  <p>
   20131227: I have now 'played' with the neat table from unicam. Coded a quick DEM30 C++ loader,
   and loaded the 33 GTOPO30 DEM files, all except ANTARCPS, which is a little different. And
   wrote each out to a BMP file of the same width, height as the DEM. Looks nice... But nothing is
   cast in stone, and can be changed with a few strokes of the pen ;=))
  </p>

  <p>
   Actually they are not 'really' DEM files, in that their format is more like that of a HGT file.
   They have no A and B records, but are a simple set of 16-bit integers, in Motorola format, row
   by row, with no file header, but do have a separatate .HDR file which gives them their
   credentials. It was 'fun' sorting through LOTS of very 'faulty' documentaion to be able to
   output a good image. A sample of E020N40 is shown below - click image to load full size... to
   me it is absolute magic at full size!
  </p>

  <div align="center">
   <p align="center">
    <a target="_blank"
       href="images/E020N40.dem.png"><img src="images/E020N40.dem.png"
         width="480"
         height="600"
         alt="E020N40 DEM as BMP, then converted (by im) to PNG"></a>
   </p>
  </div>

  <p>
   The next bit of 'fun' will be to try to 'reduce' the width, height of the output by averaging
   in some way the color height map I build... feels interesting... but off for a big lunch
   tomorrow so will not get much computer time.
  </p>

  <p>
   <a target="_blank"
      href="http://tidy.sourceforge.net/"><img border="0"
        src="images/checked_by_tidy.gif"
        alt="checked by tidy"
        width="32"
        height="32"></a>&nbsp; <a href="http://validator.w3.org/check?uri=referer"
      target="_blank"><img src="images/valid-html401.gif"
        alt="Valid HTML 4.01 Transitional"
        width="88"
        height="31"></a>
  </p>
  <!-- 20131225 - added page - experiments in generating a color height mapping scale -->
 </body>
</html>
